# .github/workflows/gemini_review.yml

name: Gemini Automated Code Review

# 워크플로우 실행 조건 정의
on:
  # 1. PR이 생성/재개되거나 새 커밋이 푸시될 때 자동으로 실행
  pull_request:
    types: [opened, reopened, synchronize]

  # 2. GitHub Actions 탭에서 수동으로 실행 가능하도록 설정 (기존 PR 리뷰용)
  workflow_dispatch:
    inputs:
      pr_number:
        description: '리뷰할 PR 번호를 입력하세요 (예: 123)'
        required: true
        type: number

jobs:
  gemini_code_review:
    runs-on: ubuntu-latest
    permissions:
      # PR에 댓글을 남기기 위해 필요
      pull-requests: write
      # 코드 변경 사항을 읽기 위해 필요
      contents: read

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # PR 번호 결정:
      # - 자동 실행 시: 이벤트(github.event.pull_request.number)에서 가져옴
      # - 수동 실행 시: inputs.pr_number에서 가져옴
      - name: Set PR Number
        id: pr_num_setter
        run: |
          if [ "${{ github.event_name }}" == "workflow_dispatch" ]; then
            echo "pr_number=${{ github.event.inputs.pr_number }}" >> $GITHUB_OUTPUT
          else
            echo "pr_number=${{ github.event.pull_request.number }}" >> $GITHUB_OUTPUT
          fi

      - name: Run Gemini CLI for Code Review
        uses: google-github-actions/run-gemini-cli@v1
        with:
          api_key: ${{ secrets.GEMINI_API_KEY }}
          command: pr-review
          model: 'gemini-2.5-flash'
          # 위에서 설정한 PR 번호를 command 인수로 전달
          args: '--pr-number ${{ steps.pr_num_setter.outputs.pr_number }}'
          # 사용자 정의 리뷰 프롬프트 설정
          prompt: |
            당신은 시니어 프론트엔드 개발자입니다. 아래 코드 변경 사항을 면밀히 검토하고 
            1. 잠재적인 버그나 로직 오류
            2. 성능 저하를 유발하는 부분
            3. 타입스크립트 문법 오류 및 보완점
            4. 한국어 주석과 변수명 스타일에 대한 지적
            5. 중복되는 코드 및 하드 코딩된 부분
            6. 최소 5개에서 10개 이하의 리뷰
            에 초점을 맞춰 구체적인 제안과 함께 리뷰를 작성해주세요. 리뷰는 **파일별**로 간결하고 건설적이어야 합니다.
